side = """eyJrZXlwb2ludHMiOiBbeyJ4IjogOC4wLCAieSI6IDguMCwgInNpemUiOiAzMS4wLCAiYW5nbGUiOiA0OC4yMDI3MDkxOTc5OTgwNSwgInJlc3BvbnNlIjogMS43NzcyMzEwOTExODIzMjk3ZS0wNywgIm9jdGF2ZSI6IDAsICJjbGFzc19pZCI6IC0xfSwgeyJ4IjogNi4wLCAieSI6IDEwLjAsICJzaXplIjogMzEuMCwgImFuZ2xlIjogNDkuMDAxMTg2MzcwODQ5NjEsICJyZXNwb25zZSI6IDIuNTU3NTg0MzY2NTEzNzY1NGUtMDcsICJvY3RhdmUiOiAwLCAiY2xhc3NfaWQiOiAtMX0sIHsieCI6IDEyLjk2MDAwMDk5MTgyMTI4OSwgInkiOiAxMS41MjAwMDA0NTc3NjM2NzIsICJzaXplIjogNDQuNjQwMDAzMjA0MzQ1NywgImFuZ2xlIjogNDMuNzA5NTc5NDY3NzczNDQsICJyZXNwb25zZSI6IDEuMDkyODc3NjY0NjMyMzk2OGUtMDUsICJvY3RhdmUiOiAyLCAiY2xhc3NfaWQiOiAtMX0sIHsieCI6IDEyLjA5NjAwMDY3MTM4NjcxOSwgInkiOiAxMi4wOTYwMDA2NzEzODY3MTksICJzaXplIjogNTMuNTY4MDA0NjA4MTU0MywgImFuZ2xlIjogNDUuMzk3NzM1NTk1NzAzMTI1LCAicmVzcG9uc2UiOiAxLjM1MTIzOTI3OTc1NjU1NTNlLTA1LCAib2N0YXZlIjogMywgImNsYXNzX2lkIjogLTF9LCB7IngiOiA1NTIuOTYwMDgzMDA3ODEyNSwgInkiOiAyNzEuMjk2MDIwNTA3ODEyNSwgInNpemUiOiA1My41NjgwMDQ2MDgxNTQzLCAiYW5nbGUiOiAyNDEuNjc2MTMyMjAyMTQ4NDQsICJyZXNwb25zZSI6IDMuMjE0NzA3NzAzNTkxNTU3MmUtMDYsICJvY3RhdmUiOiAzLCAiY2xhc3NfaWQiOiAtMX0sIHsieCI6IDY1Ni42NDAwNzU2ODM1OTM4LCAieSI6IDI3My4wMjQwMTczMzM5ODQ0LCAic2l6ZSI6IDUzLjU2ODAwNDYwODE1NDMsICJhbmdsZSI6IDI1Mi4wMTgzODY4NDA4MjAzLCAicmVzcG9uc2UiOiA2LjI5MzEyNjcxNjYyNzczOWUtMDYsICJvY3RhdmUiOiAzLCAiY2xhc3NfaWQiOiAtMX0sIHsieCI6IDEyLjQ0MTYwMTc1MzIzNDg2MywgInkiOiAxMi40NDE2MDE3NTMyMzQ4NjMsICJzaXplIjogNjQuMjgxNjA4NTgxNTQyOTcsICJhbmdsZSI6IDQ0LjU5MTY1OTU0NTg5ODQ0LCAicmVzcG9uc2UiOiAxLjU5MTY1MTAxNjQ5NzA1MzJlLTA1LCAib2N0YXZlIjogNCwgImNsYXNzX2lkIjogLTF9LCB7IngiOiA1NTEuNTc3Njk3NzUzOTA2MiwgInkiOiAyNzEuNjQxNjMyMDgwMDc4MSwgInNpemUiOiA2NC4yODE2MDg1ODE1NDI5NywgImFuZ2xlIjogMTAyLjkzMDA0NjA4MTU0Mjk3LCAicmVzcG9uc2UiOiA0LjkyNTg0NjA0MjE2OTcyNGUtMDYsICJvY3RhdmUiOiA0LCAiY2xhc3NfaWQiOiAtMX0sIHsieCI6IDEyLjQ0MTYwMjcwNjkwOTE4LCAieSI6IDEyLjQ0MTYwMjcwNjkwOTE4LCAic2l6ZSI6IDc3LjEzNzkzOTQ1MzEyNSwgImFuZ2xlIjogNDcuMTcyNzI1Njc3NDkwMjM0LCAicmVzcG9uc2UiOiAyLjMwMjI2NDY5Mjg0Mzg5MTdlLTA1LCAib2N0YXZlIjogNSwgImNsYXNzX2lkIjogLTF9LCB7IngiOiA1NTIuNDA3MTY1NTI3MzQzOCwgInkiOiAyNzEuMjI2OTU5MjI4NTE1NiwgInNpemUiOiA3Ny4xMzc5Mzk0NTMxMjUsICJhbmdsZSI6IDk4Ljc3NDAwOTcwNDU4OTg0LCAicmVzcG9uc2UiOiA0Ljk5NjMxMjMyNzQyMTAzNzVlLTA2LCAib2N0YXZlIjogNSwgImNsYXNzX2lkIjogLTF9LCB7IngiOiA1NDkuNDIxMjAzNjEzMjgxMiwgInkiOiAyNjguNzM4NjQ3NDYwOTM3NSwgInNpemUiOiA5Mi41NjU1Mjg4Njk2Mjg5LCAiYW5nbGUiOiAxMDUuODg2MTYxODA0MTk5MjIsICJyZXNwb25zZSI6IDQuMzY4Nzc4NzE4MzQ0NDAxNmUtMDYsICJvY3RhdmUiOiA2LCAiY2xhc3NfaWQiOiAtMX1dLCAiZGVzY3JpcHRvcnMiOiBbWzkyLCAxNzYsIDU3LCAyMjUsIDE2NSwgMjA1LCAxMjMsIDE0NCwgNDcsIDIzMywgMTkwLCA0MCwgMTU5LCAzMSwgNjQsIDExMiwgMTkxLCAxODEsIDE5MSwgMCwgOSwgMzIsIDEyMSwgMjEwLCAyMjMsIDIyMSwgMzksIDI0NywgMTk0LCAxMzgsIDEwMywgNTFdLCBbOTAsIDU2LCA1OSwgMjQwLCAzNywgMjA0LCA1NywgODIsIDE3MywgMjA0LCAxNTAsIDMsIDE1OCwgMTU5LCA5NywgNzQsIDE2NCwgMjQ3LCAyNTUsIDE2LCAwLCAyMTcsIDE3NiwgMjI2LCAyMTksIDIxMywgMTUsIDgzLCAxMzAsIDY0LCAzNywgMTE1XSwgWzEyMCwgNjMsIDEyMSwgMTAwLCAxNzYsIDIyMSwgODcsIDE1MCwgMTA3LCAxNzIsIDI1MiwgOCwgMTg3LCAxODUsIDY1LCA0OCwgMTM4LCAyNTQsIDc2LCA3MiwgMTU0LCA1OCwgMjQwLCA2MSwgMjUxLCAyNTMsIDM2LCA1NywgMjI0LCAyMDAsIDcwLCA0M10sIFsxMDQsIDEyNSwgNTgsIDExMCwgMTEzLCAxNDEsIDgyLCAxMTgsIDEwNSwgMTQwLCAxMjQsIDksIDE5MSwgMTg3LCAwLCAxNiwgMTMyLCAyNTEsIDY5LCA4MCwgNzQsIDE4NiwgMTQ0LCA2MywgMjUxLCAyNTMsIDM2LCAxMDUsIDY0LCAxMzAsIDcxLCAxMV0sIFs2NiwgMjQ5LCAxNDksIDI2LCAxNjksIDE0MSwgMTgsIDE0MSwgMTcxLCA2MSwgMTI4LCAxMywgMTc0LCAxOTQsIDY0LCAxNTAsIDEyOCwgMTE1LCAyMzIsIDg1LCAyMiwgNzUsIDIxOCwgNDksIDE4NSwgMTQ0LCAxMywgMTIyLCAxNiwgMjIsIDEzNSwgMzBdLCBbMTE3LCAyMzMsIDE1MSwgNjksIDU2LCAxNDMsIDk4LCAyMDgsIDIzNCwgMTY4LCAxNjIsIDc2LCAyMTUsIDEyOCwgMTkzLCAyNDIsIDE3NiwgMjI4LCAxMTAsIDExMCwgMjAxLCAxNjEsIDE1NSwgNDAsIDE4OCwgMTg0LCAzNywgNjAsIDcyLCAxNzksIDc1LCAwXSwgWzQwLCAxNzMsIDI2LCAxMTAsIDExMiwgMTQxLCAxMTQsIDI0NiwgNjEsIDksIDEyNCwgNzMsIDYzLCAxNTUsIDMyLCAxNiwgMTM0LCAxODcsIDYsIDcyLCAxMDYsIDE4NiwgMCwgNjMsIDI1NSwgMjUzLCAzNiwgMzMsIDk2LCAxNDYsIDIwMiwgMTM5XSwgWzEyMSwgNTIsIDIzNiwgNSwgMTksIDEyMiwgNzEsIDYzLCAxMTUsIDIzMCwgMjM4LCAxNTYsIDEwNywgMzYsIDEzMSwgMTgwLCA1NywgMTk4LCAyMzIsIDQ0LCAxODgsIDI1MCwgMjUzLCAxNSwgMjUxLCAyMzEsIDg1LCAyMSwgMjI3LCAyMjgsIDk0LCAxMjZdLCBbMjQsIDE3NSwgMjYsIDEyNywgMTEyLCAxNDEsIDExNCwgMjQ2LCA2MSwgOCwgMTIwLCA2NCwgNjMsIDIxMSwgMzIsIDgxLCAxNjQsIDI1MSwgNiwgNjYsIDY2LCAxODYsIDAsIDYxLCAyMjcsIDIzNywgMzIsIDgsIDExNCwgMTMwLCAxMDcsIDEzOV0sIFsxMjAsIDUyLCAxNzMsIDUsIDE5LCAxMjcsIDgxLCAyNywgNTUsIDIzNywgMjMxLCAyOSwgNjcsIDUzLCAyLCA2MSwgMjEsIDE0MCwgMjM3LCA1MiwgMTcyLCAyMTYsIDI0NSwgMTIsIDIxOSwgMjMxLCAxMTMsIDE1MSwgMjI3LCAzNiwgODYsIDEyN10sIFsyNDIsIDIwLCAyMzMsIDEwMSwgMTksIDExMCwgODIsIDM1LCAxMTUsIDIzMywgMjI3LCAyMjEsIDgyLCA2MSwgNCwgODgsIDE3NywgMTU5LCAyNTMsIDE2LCAxODQsIDI0OCwgMjQ1LCAzMSwgMjE5LCAzOCwgMTYsIDIxNCwgMjI1LCA1LCA4NiwgMTE5XV19"""

import base64
import json
import numpy as np
import cv2


# 解码恢复特征数据的函数
def decode():

    # 解码base64字符串
    decoded_bytes = base64.b64decode(side)
    features_dict = json.loads(decoded_bytes)

    # 恢复关键点
    keypoints = []
    for kp_dict in features_dict["keypoints"]:
        kp = cv2.KeyPoint(
            x=kp_dict["x"],
            y=kp_dict["y"],
            size=kp_dict["size"],
            angle=kp_dict["angle"],
            response=kp_dict["response"],
            octave=kp_dict["octave"],
            class_id=kp_dict["class_id"],
        )
        keypoints.append(kp)

    # 恢复描述子
    descriptors = np.array(features_dict["descriptors"], dtype=np.uint8)

    return keypoints, descriptors


def save_features_to_file(keypoints, descriptors, output_path):
    keypoints_list = []
    for kp in keypoints:
        keypoints_list.append(
            {
                "x": float(kp.pt[0]),
                "y": float(kp.pt[1]),
                "size": float(kp.size),
                "angle": float(kp.angle),
                "response": float(kp.response),
                "octave": int(kp.octave),
                "class_id": int(kp.class_id),
            }
        )

    # 创建特征字典
    features_dict = {"keypoints": keypoints_list, "descriptors": descriptors.tolist()}

    # 将特征保存为JSON
    with open(output_path, "w") as f:
        json.dump(features_dict, f)

    return True


keypoints, descriptors = decode()

save_features_to_file(keypoints, descriptors, "side.json")


def runpipeline(image, llrobot):
    return np.array([]), image, [0, 0, 0, 0, 0, 0, 0, 0]
